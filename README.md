# 常見需求整理

~~~
類型	需求描述
連線管理	玩家可加入/離開房間，維持連線、心跳、重連
遊戲管理	支援配對、房間、洗牌、出牌規則、大老二遊戲流程
資料同步	玩家之間同步手牌、回合狀態、勝負結果
多人支援	支援多桌同時進行，每桌 4 位玩家
並發處理	多個遊戲房間需並行運行
安全性與防作弊	基本檢查非法行為（例如出錯牌）與封包驗證
擴充性	易於未來加入排行榜、帳號系統、聊天室等
~~~

# 架構設計概覽

~~~
[ Client ] <--> [ Server Core ]
                      |
        +-------------+-------------+
        |             |             |
  [ Connection ]  [ Game Room ]  [ Matchmaking ]
        |             |
  asio / WebSocket    |---> 玩家狀態、手牌、順序、回合邏輯
                      |
                出牌合法判斷、大老二邏輯
~~~

# 技術選型

~~~
功能	推薦工具	原因說明
網路通訊	[Boost.Asio] 或 [uWebSockets]	高效、跨平台、非阻塞
JSON 封包格式	nlohmann/json	header-only、易於整合
多執行緒	C++17 thread / task pool	控制並行的遊戲房間
遊戲邏輯	自行實作	需自訂出牌規則
封包加密（可選）	OpenSSL 或簡單 checksum	防止簡易封包偽造
測試	Catch2	單元測試與斷言
序列化（可選）	FlatBuffers / Protobuf	若需要高效或二進位封包傳輸
~~~

# 伺服器實作概念模組

- Connection Layer（Boost.Asio TCP）
  - 處理連線、接收與解析封包、轉發到遊戲邏輯：
- Matchmaking / Lobby
  - 將玩家自動配對進遊戲房間：
- Game Room / Engine
  - 管理一桌的玩家、狀態、出牌邏輯：
- Card Engine（自訂）
  - 實作大老二的出牌判斷邏輯：
- 封包格式設計（JSON）
~~~

~~~

# 示例遊戲流程（簡化）

- 玩家連線 → 傳送登入資訊
- 加入配對池（Matchmaking）
- 四人配對成功 → 建立 GameRoom → 發牌
- 玩家輪流出牌（Server 判斷是否合法）
- 有人出完 → Server 廣播結束與名次

# 可能需要自我實作的部分

~~~
模組	原因
出牌合法性判斷	大老二牌型多、需要客製
遊戲狀態管理	輪到誰出牌、跳過、清場等
封包路由	因應多玩家同時處理
玩家同步	廣播 vs 單播邏輯
安全檢查	防止非法出牌與作弊
~~~

# 延伸與優化建議

- 支援 WebSocket：若前端使用瀏覽器，建議用 uWebSockets 或 Boost.Beast
- 資料持久化：儲存玩家勝率、牌局記錄，可用 SQLite 或簡易 JSON
- 排行榜系統：Server 加總統計數據廣播至所有人
- 房間系統：可自選進入房間而非自動配對

